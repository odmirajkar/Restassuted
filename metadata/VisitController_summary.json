{
  "file_name": "VisitController.java",
  "file_path": "org/springframework/samples/petclinic/owner/VisitController.java",
  "file_summary": "The `VisitController` class acts as a Spring MVC controller responsible for handling web requests related to managing pet visits in the PetClinic application. It is annotated with `@Controller`, indicating its role in the presentation layer.\n\nThis controller relies on an `OwnerRepository` to interact with owner and pet data. It utilizes an `@InitBinder` to prevent binding the `id` field, enhancing security. A crucial aspect is the `@ModelAttribute(\"visit\")` method, `loadPetWithVisit`, which is executed before form-handling methods. This method fetches the `Owner` and `Pet` based on path variables, creates a new `Visit` object, associates it with the retrieved pet, and populates the Spring model with these objects, ensuring that fresh data and an initialized `Visit` are always available for the forms.\n\nIt defines a `@GetMapping` endpoint to display the form for creating a new visit and a `@PostMapping` endpoint to process the submission of this form. The `processNewVisitForm` method performs validation on the `Visit` object. If validation fails, it returns to the form; otherwise, it adds the visit to the owner's pet, saves the updated owner entity via the repository, and redirects to the owner's details page with a success message. This class orchestrates the user interface flow for recording pet visits.",
  "attributes": [
    {
      "name": "owners",
      "data_type": "OwnerRepository",
      "membership_type": "private final"
    }
  ],
  "functions": [
    "VisitController(OwnerRepository owners)",
    "setAllowedFields(WebDataBinder dataBinder): void",
    "loadPetWithVisit(@PathVariable(\"ownerId\") int ownerId, @PathVariable(\"petId\") int petId, Map<String, Object> model): Visit",
    "initNewVisitForm(): String",
    "processNewVisitForm(@ModelAttribute Owner owner, @PathVariable int petId, @Valid Visit visit, BindingResult result, RedirectAttributes redirectAttributes): String"
  ],
  "dependent_class_list": [
    "java.util.Map",
    "java.util.Optional",
    "org.springframework.stereotype.Controller",
    "org.springframework.validation.BindingResult",
    "org.springframework.web.bind.WebDataBinder",
    "org.springframework.web.bind.annotation.GetMapping",
    "org.springframework.web.bind.annotation.InitBinder",
    "org.springframework.web.bind.annotation.ModelAttribute",
    "org.springframework.web.bind.annotation.PathVariable",
    "org.springframework.web.bind.annotation.PostMapping",
    "jakarta.validation.Valid",
    "org.springframework.web.servlet.mvc.support.RedirectAttributes",
    "OwnerRepository",
    "Owner",
    "Pet",
    "Visit"
  ]
}