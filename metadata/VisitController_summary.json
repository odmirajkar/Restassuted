{
  "file_name": "VisitController.java",
  "file_path": "org/springframework/samples/petclinic/owner/VisitController.java",
  "file_summary": "The `VisitController` class is a Spring MVC `@Controller` responsible for handling web requests related to managing pet visits within the PetClinic application. It orchestrates the process of adding new visits to a pet associated with a specific owner.\n\nKey functionalities include:\n- **Data Binding Control**: It uses `@InitBinder` to prevent binding of the `id` field, enhancing security.\n- **Model Preparation**: The `@ModelAttribute(\"visit\") loadPetWithVisit` method is executed before relevant request handlers. It retrieves the `Owner` and `Pet` based on path variables (`ownerId` and `petId`), adds them to the model, and initializes a new `Visit` object, associating it with the pet. This ensures fresh data and proper `Pet` object context.\n- **Displaying Form**: The `initNewVisitForm` method handles GET requests to display the form for creating a new visit.\n- **Processing Form Submission**: The `processNewVisitForm` method handles POST requests, validates the submitted `Visit` data using `@Valid`. If validation passes, the new visit is added to the pet, and the `Owner` is saved through the `OwnerRepository`. If there are errors, the form is re-displayed. A success message is added as a flash attribute upon successful booking.\n\nThis controller ensures a smooth user experience for scheduling and recording pet visits.",
  "attributes": [
    {
      "name": "owners",
      "type": "OwnerRepository",
      "membership_type": "private final"
    }
  ],
  "functions": [
    {
      "name": "VisitController",
      "return_type": "void",
      "parameters": [
        {
          "name": "owners",
          "type": "OwnerRepository"
        }
      ]
    },
    {
      "name": "setAllowedFields",
      "return_type": "void",
      "parameters": [
        {
          "name": "dataBinder",
          "type": "WebDataBinder"
        }
      ]
    },
    {
      "name": "loadPetWithVisit",
      "return_type": "Visit",
      "parameters": [
        {
          "name": "ownerId",
          "type": "int"
        },
        {
          "name": "petId",
          "type": "int"
        },
        {
          "name": "model",
          "type": "Map<String, Object>"
        }
      ]
    },
    {
      "name": "initNewVisitForm",
      "return_type": "String",
      "parameters": []
    },
    {
      "name": "processNewVisitForm",
      "return_type": "String",
      "parameters": [
        {
          "name": "owner",
          "type": "Owner"
        },
        {
          "name": "petId",
          "type": "int"
        },
        {
          "name": "visit",
          "type": "Visit"
        },
        {
          "name": "result",
          "type": "BindingResult"
        },
        {
          "name": "redirectAttributes",
          "type": "RedirectAttributes"
        }
      ]
    }
  ]
}